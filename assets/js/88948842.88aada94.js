"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[2944],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=c(n),m=o,h=u["".concat(l,".").concat(m)]||u[m]||p[m]||i;return n?a.createElement(h,r(r({ref:t},d),{},{components:n})):a.createElement(h,r({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var c=2;c<i;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4959:(e,t,n)=>{n.d(t,{Z:()=>s});var a=n(7294),o=n(9960),i=n(4477),r=n(2263);const s=function(e){var t=e.to,n=e.children,s=(0,i.E)();return(0,r.default)().siteConfig.presets[0][1].docs.disableVersioning?a.createElement(o.default,{to:"/api/"+t},n):a.createElement(o.default,{to:"/api/"+("current"===s.version?"next":s.version)+"/"+t},n)}},8204:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>d,default:()=>v,frontMatter:()=>c,metadata:()=>p,toc:()=>m});var a=n(7462),o=n(3366),i=(n(7294),n(3905)),r=n(4959),s=n(1435);var l=["components"],c={id:"scaling-crawlers",title:"Scaling our crawlers",description:"To infinity and beyond! ...within limits"},d=void 0,p={unversionedId:"guides/scaling-crawlers",id:"guides/scaling-crawlers",title:"Scaling our crawlers",description:"To infinity and beyond! ...within limits",source:"@site/../docs/guides/scaling_crawlers.mdx",sourceDirName:"guides",slug:"/guides/scaling-crawlers",permalink:"/docs/guides/scaling-crawlers",draft:!1,tags:[],version:"current",lastUpdatedBy:"Andrey Bykov",lastUpdatedAt:1657805876,formattedLastUpdatedAt:"7/14/2022",frontMatter:{id:"scaling-crawlers",title:"Scaling our crawlers",description:"To infinity and beyond! ...within limits"},sidebar:"docs",previous:{title:"Session Management",permalink:"/docs/guides/session-management"},next:{title:"Avoid getting blocked",permalink:"/docs/guides/avoid-blocking"}},u={},m=[{value:"<code>maxRequestsPerMinute</code>",id:"maxrequestsperminute",level:2},{value:"<code>minConcurrency</code> and <code>maxConcurrency</code>",id:"minconcurrency-and-maxconcurrency",level:2},{value:"Advanced options",id:"advanced-options",level:2},{value:"<code>desiredConcurrency</code>",id:"desiredconcurrency",level:3},{value:"<code>desiredConcurrencyRatio</code>",id:"desiredconcurrencyratio",level:3},{value:"<code>scaleUpStepRatio</code> and <code>scaleDownStepRatio</code>",id:"scaleupstepratio-and-scaledownstepratio",level:3},{value:"<code>maybeRunIntervalSecs</code>",id:"mayberunintervalsecs",level:3},{value:"<code>loggingIntervalSecs</code>",id:"loggingintervalsecs",level:3},{value:"<code>autoscaleIntervalSecs</code>",id:"autoscaleintervalsecs",level:3},{value:"<code>maxTasksPerMinute</code>",id:"maxtasksperminute",level:3}],h={toc:m};function v(e){var t=e.components,n=(0,o.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"As we build our crawler, we might want to control how many requests we do to the website at a time. Crawlee provides several options to fine tune how many parallel requests should be made at any time, how many requests should be done per minute, and how should scaling work based on the available system resources."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"All of these options are available on all crawlers Crawlee provides, but for this guide we'll be using the ",(0,i.kt)(r.Z,{to:"cheerio-crawler/class/CheerioCrawler",mdxType:"ApiLink"},(0,i.kt)("inlineCode",{parentName:"p"},"CheerioCrawler")),". We can see all options that are available ",(0,i.kt)(r.Z,{to:"cheerio-crawler/interface/CheerioCrawlerOptions",mdxType:"ApiLink"},(0,i.kt)("inlineCode",{parentName:"p"},"here")),"."))),(0,i.kt)("h2",{id:"maxrequestsperminute"},(0,i.kt)("inlineCode",{parentName:"h2"},"maxRequestsPerMinute")),(0,i.kt)("p",null,"This controls how many total requests can be made per minute. It counts the amount of requests done every second, to ensure there is not a burst of requests at the ",(0,i.kt)("inlineCode",{parentName:"p"},"maxConcurrency")," limit followed by a long period of waiting. By default, it is set to ",(0,i.kt)("inlineCode",{parentName:"p"},"Infinity")," which means the crawler will keep going up to the ",(0,i.kt)("inlineCode",{parentName:"p"},"maxConcurrency"),". We would set this if we wanted our crawler to work at full throughput, but also not keep hitting the website we're crawling with non-stop requests."),(0,i.kt)(s.Z,{language:"js",mdxType:"CodeBlock"},"import { CheerioCrawler } from 'crawlee';\n\nconst crawler = new CheerioCrawler({\n    // Let the crawler know it can run up to 100 requests concurrently at any time\n    maxConcurrency: 100,\n    // ...but also ensure the crawler never exceeds 250 requests per minute\n    maxRequestsPerMinute: 250,\n});\n"),(0,i.kt)("h2",{id:"minconcurrency-and-maxconcurrency"},(0,i.kt)("inlineCode",{parentName:"h2"},"minConcurrency")," and ",(0,i.kt)("inlineCode",{parentName:"h2"},"maxConcurrency")),(0,i.kt)("p",null,"These control how many parallel requests can be run at any time. By default, crawlers will start with one parallel request at a time and scale up over time to a maximum of 200 requests at a time."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Don't set ",(0,i.kt)("inlineCode",{parentName:"h5"},"minConcurrency")," too high!")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Setting this option too high compared to the available system resources will make your crawler run extremely slow or might even crash."),(0,i.kt)("p",{parentName:"div"},"It's recommended to leave it at the default value that is provided and letting the crawler scale up and down automatically based on available resources instead."))),(0,i.kt)(s.Z,{language:"js",mdxType:"CodeBlock"},"import { CheerioCrawler } from 'crawlee';\n\nconst crawler = new CheerioCrawler({\n    // Start the crawler right away and ensure there will always be 5 concurrent requests ran at any time\n    minConcurrency: 5,\n    // Ensure the crawler doesn't exceed 15 concurrent requests ran at any time\n    maxConcurrency: 15,\n});\n"),(0,i.kt)("h2",{id:"advanced-options"},"Advanced options"),(0,i.kt)("p",null,"While the options above should be enough for most users, if we wanted to get super deep into the configuration of the autoscaling pool (the internal utility in Crawlee that helps us allow crawlers to scale up and down), we can do so through the ",(0,i.kt)(r.Z,{to:"cheerio-crawler/interface/CheerioCrawlerOptions#autoscaledPoolOptions",mdxType:"ApiLink"},(0,i.kt)("inlineCode",{parentName:"p"},"autoscaledPoolOptions"))," object available on crawler options."),(0,i.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Complex options up ahead!")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This section is super advanced and, unless you test the changes extensively and know what you're doing, it's better to leave these options to their defaults, as they are most likely going to work fine without much fuss."))),(0,i.kt)("p",null,"With that warning aside, if we're feeling adventurous, this is how we would pass these options when using a crawler:"),(0,i.kt)(s.Z,{language:"js",mdxType:"CodeBlock"},"import { CheerioCrawler } from 'crawlee';\n\nconst crawler = new CheerioCrawler({\n    // Pass in advanced options by providing them in the autoscaledPoolOptions\n    autoscaledPoolOptions: {\n        // ...\n    },\n});\n"),(0,i.kt)("h3",{id:"desiredconcurrency"},(0,i.kt)("inlineCode",{parentName:"h3"},"desiredConcurrency")),(0,i.kt)("p",null,"This option specifies the amount of requests that should be running in parallel at the start of the crawler, assuming there are so many available. It defaults to the same value as ",(0,i.kt)("inlineCode",{parentName:"p"},"minConcurrency"),"."),(0,i.kt)("h3",{id:"desiredconcurrencyratio"},(0,i.kt)("inlineCode",{parentName:"h3"},"desiredConcurrencyRatio")),(0,i.kt)("p",null,"The minimum ratio of concurrency to reach before more scaling up is allowed (a number between ",(0,i.kt)("inlineCode",{parentName:"p"},"0")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"1"),"). By default, it is set to ",(0,i.kt)("inlineCode",{parentName:"p"},"0.95"),"."),(0,i.kt)("p",null,"We can think of this as the point where the autoscaling pool can attempt to scale up (or down), monitor if there's any changes, and correct them if necessary."),(0,i.kt)("h3",{id:"scaleupstepratio-and-scaledownstepratio"},(0,i.kt)("inlineCode",{parentName:"h3"},"scaleUpStepRatio")," and ",(0,i.kt)("inlineCode",{parentName:"h3"},"scaleDownStepRatio")),(0,i.kt)("p",null,"These values define the fractional amount of desired concurrency to be added or subtracted as the autoscaling pool scales up or down. Both of these values default to ",(0,i.kt)("inlineCode",{parentName:"p"},"0.05"),"."),(0,i.kt)("p",null,"Every time the autoscaled pool attempts to scale up or down, this value will be added or subtracted from the current concurrency, and, based on the ",(0,i.kt)("a",{parentName:"p",href:"#desiredconcurrencyratio",target:null,rel:null},(0,i.kt)("inlineCode",{parentName:"a"},"desiredConcurrencyRatio"))," and ",(0,i.kt)("a",{parentName:"p",href:"#minconcurrency-and-maxconcurrency",target:null,rel:null},(0,i.kt)("inlineCode",{parentName:"a"},"maxConcurrency")),", determines how many requests can run concurrently."),(0,i.kt)("h3",{id:"mayberunintervalsecs"},(0,i.kt)("inlineCode",{parentName:"h3"},"maybeRunIntervalSecs")),(0,i.kt)("p",null,"Indicates how often the autoscaling pool should check if more requests can be started and, if that's true, starts a new request if there are any available. This value is represented in seconds, and defaults to ",(0,i.kt)("inlineCode",{parentName:"p"},"0.5"),"."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Changing this has no effect for requests that are fired immediately after the previous ones are finished. However, it will influence how fast new requests will be started after the autoscaled pool scales up."))),(0,i.kt)("h3",{id:"loggingintervalsecs"},(0,i.kt)("inlineCode",{parentName:"h3"},"loggingIntervalSecs")),(0,i.kt)("p",null,"This option lets us control how often the autoscaled pool should log its current state (the current concurrency ratio, desired ratios, if the system is overloaded and so on)."),(0,i.kt)("p",null,"We can disable logging altogether by setting this to ",(0,i.kt)("inlineCode",{parentName:"p"},"null"),". By default, it is set to ",(0,i.kt)("inlineCode",{parentName:"p"},"60")," seconds."),(0,i.kt)("h3",{id:"autoscaleintervalsecs"},(0,i.kt)("inlineCode",{parentName:"h3"},"autoscaleIntervalSecs")),(0,i.kt)("p",null,"This option lets us control how often the autoscaling pool should check if it can and should scale up or down. This value is represented in seconds, and defaults to ",(0,i.kt)("inlineCode",{parentName:"p"},"10"),"."),(0,i.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"It's recommended you keep this value between ",(0,i.kt)("inlineCode",{parentName:"p"},"5")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"20")," seconds."))),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Be careful with how low, or high, you set this option")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Setting this option to a value that's too low might have a severe impact on our crawling performance. And, in reverse, setting this to a value that's too high might mean we leave performance on the table that could've been used for crawling more requests instead."),(0,i.kt)("p",{parentName:"div"},"With that said, if you configure this alongside ",(0,i.kt)("a",{parentName:"p",href:"#scaleupstepratio-and-scaledownstepratio",target:null,rel:null},(0,i.kt)("inlineCode",{parentName:"a"},"scaleUpStepRatio")," and ",(0,i.kt)("inlineCode",{parentName:"a"},"scaleDownStepRatio")),", you could make your crawler scale up at a slower interval, but with more requests at a time when it does."))),(0,i.kt)("h3",{id:"maxtasksperminute"},(0,i.kt)("inlineCode",{parentName:"h3"},"maxTasksPerMinute")),(0,i.kt)("p",null,"This controls how many total requests can be made per minute. It counts the amount of requests done every second, to ensure there is not a burst of requests at the ",(0,i.kt)("inlineCode",{parentName:"p"},"maxConcurrency")," limit followed by a long period of waiting. By default, it is set to ",(0,i.kt)("inlineCode",{parentName:"p"},"Infinity")," which means the crawler will keep going up to the ",(0,i.kt)("inlineCode",{parentName:"p"},"maxConcurrency"),". We would set this if we wanted our crawler to work at full throughput, but also not keep hitting the website we're crawl with non-stop requests."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This option can be set by specifying ",(0,i.kt)("a",{parentName:"p",href:"#maxrequestsperminute",target:null,rel:null},(0,i.kt)("inlineCode",{parentName:"a"},"maxRequestsPerMinute"))," in your crawler options too, as it is a shortcut for visibility and ease of access."))))}v.isMDXComponent=!0}}]);